{% extends 'shop/basic.html' %}
{% block css %}
.col-md-3 {
display: inline-block;
margin-left: 8px;
}


.card-img-top {
max-width: 97%;
max-height: 57%;}


body .no-padding {
padding-left: 0;
padding-right: 0;
}

.carousel-control-prev-icon {
background: black no-repeat center center;
background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8
8'%3e%3cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3e%3c/svg%3e");
}

.carousel-control-next-icon {
background: black no-repeat center center;
background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8
8'%3e%3cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3e%3c/svg%3e");

}

.carousel-control-next, .carousel-control-prev {
top:auto;
bottom:auto;
padding-top: 213px;
}


body .carousel-indicators{
bottom:0;
}

.carousel-indicators .active{
background-color: blue;
}





{% endblock %}
{% block body %}
{% load static %}



<!--        carousel indicators starts from here-->

<div class="container">

  {% for product,range, nslides in allProds%}

  <h1>{{product.0.category}}</h1>
  <div class="row">
    <div id="demo{{forloop.counter}}" class="col carousel slide my-3" data-ride="carousel">'
      <ul class="carousel-indicators">
        <li data-target="#demo{{forloop.counter}}" data-slide-to="0" class="active"></li>
        {% for i in range %}
        <li data-target="#demo{{forloop.parent.counter}}" data-slide-to="{{i}}"></li>
        {% endfor %}
      </ul>

      <!--        slideshow starts here-->

      <div class="carousel-inner">
        <div class="carousel-item active">

          {% for i in product %}
          <div class="col-xs-3 col-sm-3 col-md-3">
            <div class="card" style="width: 18rem; height: 25rem;   ">
              <img src='/media/{{i.image}}' class="card-img-top" height="200px" width="200px" alt="...">
              <div class="card-body">
                <h5 class="card-title">{{i.product_name}}</h5>
                <p class="card-text">{{i.desc}}</p>
                <span id="divpr{{i.id}}" class="divpr">
                  <button id="pr{{i.id}}" class="btn btn-primary cart">Add to cart</button>
                </span>
                <a href="/shop/product/{{i.product_name}}"><button id="qv{{i.id}}" class="btn btn-primary cart">Qucik
                    view</button></a>
              </div>
            </div>
          </div>

          {% if forloop.counter|divisibleby:4 and not forloop.last %}
        </div>
        <div class="carousel-item">
          {% endif%}

          {% endfor %}
        </div>

      </div>
    </div>

    <a class="carousel-control-prev " href="#demo{{forloop.counter}}" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#demo{{forloop.counter}}" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
  {% endfor %}
</div>

{% block js %}


<script>

  // finding the cart item in localStorage

  if (localStorage.getItem('cart') == null) {
    var cart = {};
  }
  else {
    // loading the cart if cart has products
    updateCart(cart)
    cart = JSON.parse(localStorage.getItem('cart'))
    var total = 0
    for (var i in cart) {
      total = total + cart[i]
    }
    //   changine cart innerhtml to its increased value 
    document.getElementById('cart').innerHTML = total;
  }

  //   if the addtocart button is clicked , add increase the item 
  // jQuery

  $('.cart').click(function () {

    // taking id of the product 
    var idstr = this.id.toString();


    if (cart[idstr] != undefined) {
      cart[idstr] = cart[idstr] + 1;
    }
    else {
      cart[idstr] = 1;
    }
    updateCart(cart)
    localStorage.setItem('cart', JSON.stringify(cart));

    // used to print the cart item in cart
    var total = 0
    for (var i in cart) {
      total = total + cart[i]
    }
    document.getElementById('cart').innerHTML = total;
    //   document.getElementById('cart').innerHTML = Object.keys(cart).length;
  });



  // popover show is tooltip displaying logic


  $('#pop').popover()
  document.getElementById('pop').setAttribute('data-content', '<h5>Cart</h5>')




  function updateCart() {
    for (var item in cart) {
      // here id is defined like divpr1 divpr2 by using for loop div+item return divpr1 and so on....
      document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" +
        item + "''>" + cart[item] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";
    }
  }

  // jQuery for minus button 
  $('.divpr').on('click', 'button.minus', function () {
    a = this.id.slice(7,)
    cart['pr' + a] = cart['pr' + a] - 1
    Math.max(0, cart['pr' + a])

    document.getElementById('valpr' + a).innerHTML = cart['pr' + a]
    updateCart()
  })



  // jQuery for plus button 
  $('.divpr').on('click', 'button.plus', function () {
    a = this.id.slice(6,)
    cart['pr' + a] = cart['pr' + a] + 1

    document.getElementById('valpr' + a).innerHTML = cart['pr' + a]
    updateCart()
  })





</script>

{% endblock%}





{% endblock %}